<script>
const game = document.getElementById("game");
const hero = document.getElementById("hero");
const monster = document.getElementById("monster");
const gift = document.getElementById("gift");
const startBtn = document.getElementById("startBtn");
const question = document.getElementById("question");
const answers = document.querySelectorAll(".answer");

let running = false;
let bgX = 0;
let animationStarted = false;

const heroX = 80;
const monsterDistance = 600;
const giftDistance = 1000;

let monsterAlive = true;
let gameFinished = false;

function updatePositions() {
  monster.style.left = heroX + monsterDistance + bgX + "px";
  gift.style.left   = heroX + giftDistance + bgX + "px";
}

function collide(a, b) {
  const r1 = a.getBoundingClientRect();
  const r2 = b.getBoundingClientRect();
  return !(
    r1.right < r2.left ||
    r1.left > r2.right ||
    r1.bottom < r2.top ||
    r1.top > r2.bottom
  );
}

function loop() {
  if (running) {
    bgX -= 0.4; // Ð¿Ð¾Ð²Ñ–Ð»ÑŒÐ½Ñ–ÑˆÐµ â€” ÐºÑ€Ð°Ñ‰Ðµ Ð´Ð»Ñ Ð¼Ð¾Ð±Ñ–Ð»ÑŒÐ½Ð¾Ð³Ð¾
    game.style.backgroundPositionX = bgX + "px";
    updatePositions();

    if (monsterAlive && collide(hero, monster)) {
      running = false;
      question.style.display = "flex";
    }

    if (!monsterAlive && !gameFinished && collide(hero, gift)) {
      gameFinished = true;
      running = false;
      setTimeout(() => {
        alert("ðŸŽ Ð’Ñ–Ñ‚Ð°ÑŽ! ÐŸÐ¾Ð´Ð°Ñ€ÑƒÐ½Ð¾Ðº!");
      }, 100);
    }
  }

  requestAnimationFrame(loop);
}

// ÑÑ‚Ð°Ñ€Ñ‚
startBtn.onclick = () => {
  running = true;
  startBtn.style.display = "none";
  updatePositions();

  if (!animationStarted) {
    animationStarted = true;
    loop();
  }
};

// Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–
answers.forEach(a => {
  a.onclick = () => {
    monsterAlive = false;
    monster.style.display = "none";
    question.style.display = "none";
    running = true;
  };
});
</script>
